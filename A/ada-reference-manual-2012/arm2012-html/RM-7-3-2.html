<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Type Invariants</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented2Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented2Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented2NestedBulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented2NestedBulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.WideHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.2em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.WideHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,0,153)"><B>Ada Reference Manual</B></SPAN> &mdash; <A HREF="RM-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-7-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-7-4.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>7.3.2 Type Invariants</H1>
<div class="paranum">1/3</div>
<div class="Normal" style="margin-bottom: 0.4em">For a private type 
or private extension, the following language-defined aspects may be specified 
with an <SPAN Class="swiss"><A HREF="RM-13-1-1.html#S0306">aspect_specification</A></SPAN> 
(see <A HREF="RM-13-1-1.html">13.1.1</A>):</div>
<div class="paranum">2/3</div>
<div class="WideHanging-Term">Type_Invariant</div><div class="WideHanging-Body"><br clear="left">
This aspect shall be specified by an <SPAN Class="swiss"><A HREF="RM-4-4.html#S0117">expression</A></SPAN>, 
called an <I>invariant expression</I>.<A NAME="I3609"></A> Type_Invariant 
may be specified on a <SPAN Class="swiss"><A HREF="RM-7-3.html#S0193">private_type_declaration</A></SPAN>, 
on a <SPAN Class="swiss"><A HREF="RM-7-3.html#S0194">private_extension_declaration</A></SPAN>, 
or on a <SPAN Class="swiss"><A HREF="RM-3-2-1.html#S0024">full_type_declaration</A></SPAN> 
that declares the completion of a private type or private extension.<A NAME="I3610"></A><A NAME="I3611"></A></div>
<div class="paranum">3/3</div>
<div class="WideHanging-Term">Type_Invariant'Class</div><div class="WideHanging-Body"><br clear="left">
This aspect shall be specified by an <SPAN Class="swiss"><A HREF="RM-4-4.html#S0117">expression</A></SPAN>, 
called an <I>invariant expression</I>. Type_Invariant'Class may be specified 
on a <SPAN Class="swiss"><A HREF="RM-7-3.html#S0193">private_type_declaration</A></SPAN> 
or a <SPAN Class="swiss"><A HREF="RM-7-3.html#S0194">private_extension_declaration</A></SPAN>.<A NAME="I3612"></A><A NAME="I3613"></A></div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum">4/3</div>
<div class="Normal">The expected type for an invariant expression is 
any boolean type.<A NAME="I3614"></A></div>
<div class="paranum">5/3</div>
<div class="Normal">Within an invariant expression, the identifier of 
the first subtype of the associated type denotes the current instance 
of the type. Within an invariant expression associated with type <I>T</I>, 
the type of the current instance is <I>T</I> for the Type_Invariant aspect 
and <I>T</I>'Class for the Type_Invariant'Class aspect.</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum">6/3</div>
<div class="Normal">The Type_Invariant'Class aspect shall not be specified 
for an untagged type. The Type_Invariant aspect shall not be specified 
for an abstract type.</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum">7/3</div>
<div class="Normal">If the Type_Invariant aspect is specified for a type 
<I>T</I>, then the invariant expression applies to <I>T</I>.</div>
<div class="paranum">8/3</div>
<div class="Normal">If the Type_Invariant'Class aspect is specified for 
a tagged type <I>T</I>, then the invariant expression applies to all 
descendants of <I>T</I>.</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum">9/3</div>
<div class="Normal" style="margin-bottom: 0.4em">If one or more invariant 
expressions apply to a type <I>T</I>, then an invariant check is performed 
at the following places, on the specified object(s):<A NAME="I3615"></A><A NAME="I3616"></A></div>
<div class="paranum">10/3</div>
<div class="Bulleted">After successful default initialization of an object 
of type <I>T</I>, the check is performed on the new object;</div>
<div class="paranum">11/3</div>
<div class="Bulleted">After successful conversion to type <I>T</I>, the 
check is performed on the result of the conversion;</div>
<div class="paranum">12/3</div>
<div class="Bulleted">For a view conversion, outside the immediate scope 
of <I>T</I>, that converts from a descendant of <I>T</I> (including <I>T</I> 
itself) to an ancestor of type <I>T</I> (other than <I>T</I> itself), 
a check is performed on the part of the object that is of type <I>T</I>:</div>
<div class="paranum">13/3</div>
<div class="Indented2NestedBulleted">after assigning to the view conversion; 
and</div>
<div class="paranum">14/3</div>
<div class="Indented2NestedBulleted">after successful return from a call 
that passes the view conversion as an <B>in out</B> or <B>out</B> parameter. 
</div>
<div class="paranum">15/3</div>
<div class="Bulleted">After a successful call on the Read or Input stream 
attribute of the type <I>T</I>, the check is performed on the object 
initialized by the stream attribute;</div>
<div class="paranum">16/3</div>
<div class="Bulleted" style="margin-bottom: 0.3em">An invariant is checked 
upon successful return from a call on any subprogram or entry that:&nbsp;</div>
<div class="paranum">17/3</div>
<div class="Indented2Bulleted">is declared within the immediate scope 
of type <I>T</I> (or by an instance of a generic unit, and the generic 
is declared within the immediate scope of type <I>T</I>), and</div>
<div class="paranum">18/3</div>
<div class="Indented2Bulleted">is visible outside the immediate scope 
of type <I>T</I> or overrides an operation that is visible outside the 
immediate scope of <I>T</I>, and</div>
<div class="paranum">19/3</div>
<div class="Indented2Bulleted">has a result with a part of type <I>T</I>, 
or one or more parameters with a part of type <I>T</I>, or an access 
to variable parameter whose designated type has a part of type <I>T</I>. 
</div>
<div class="paranum">20/3</div>
<div class="Bulleted-NoPrefix">The check is performed on each such part 
of type <I>T</I>.&nbsp;</div>
<div class="paranum">21/3</div>
<div class="Normal">&nbsp;If performing checks is required by the Invariant 
or Invariant'Class assertion policies (see <A HREF="RM-11-4-2.html">11.4.2</A>) 
in effect at the point of corresponding aspect specification applicable 
to a given type, then the respective invariant expression is considered 
<I>enabled</I>.<A NAME="I3617"></A></div>
<div class="paranum">22/3</div>
<div class="Normal">&nbsp;The invariant check consists of the evaluation of 
each enabled invariant expression that applies to <I>T</I>, on each of 
the objects specified above. If any of these evaluate to False, Assertions.Assertion_Error 
is raised at the point of the object initialization, conversion, or call.<A NAME="I3618"></A> 
If a given call requires more than one evaluation of an invariant expression, 
either for multiple objects of a single type or for multiple types with 
invariants, the evaluations are performed in an arbitrary order, and 
if one of them evaluates to False, it is not specified whether the others 
are evaluated. Any invariant check is performed prior to copying back 
any by-copy <B>in out</B> or <B>out</B> parameters. Invariant checks, 
any postcondition check, and any constraint or predicate checks associated 
with <B>in out</B> or <B>out</B> parameters are performed in an arbitrary 
order.</div>
<div class="paranum">23/3</div>
<div class="Normal">&nbsp;The invariant checks performed on a call are determined 
by the subprogram or entry actually invoked, whether directly, as part 
of a dispatching call, or as part of a call through an access-to-subprogram 
value.</div>
<div class="NotesHeader">NOTES</div>
<div class="paranum">24/3</div>
<div class="Notes">13&nbsp;&nbsp;For a call of a primitive subprogram 
of type <I>NT</I> that is inherited from type <I>T</I>, the specified 
checks of the specific invariants of both the types <I>NT</I> and <I>T</I> 
are performed. For a call of a primitive subprogram of type <I>NT</I> 
that is overridden for type <I>NT</I>, the specified checks of the specific 
invariants of only type <I>NT</I> are performed.</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-7-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-7-4.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
